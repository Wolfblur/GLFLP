<!DOCTYPE html> 
<html>
<head>
<link rel="stylesheet" type="text/css" href="typewriter.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="mustache.min.js"></script>
</head> 


<body>
<p id="typedtext">Click this</p>
<p id="Choice">Next Choice</p>
<p id="mustacheid">text</p>

<script id="mustache">
var view = {
  gameText: {
    Text: "A red sun hangs low in the sky, echoing of Dying Earth. You are sitting on the Front Porch, wrinkled brain pumping under your wrinkled brow.",
    Index: "{{gameText.mustIndex}}"
  },
  gameText2: {
    Text: "The wind chimes chortle to themselves in their tinny tamber, and like a crystal, carry you out over the sea to the estuary. A red sun hangs low in the sky, echoing of Dying Earth. You are sitting on the Front Porch, wrinkled brain pumping under your wrinkled brow.",
    Index: "{{gameText2.mustIndex}}"
  },
  gameText3: {
    Text: "You are 26 again and your bones melt back into pliance, strength. You have taken over colin and Pete's porch.",
    Index: "{{gameText3.mustIndex}}"
  }
};
var choices = {
  gameText: {
    Text: "Choice 1",
    mustIndex: "{{gameText2.Text}}",
    Index: "{{gameText2.Index}}"
  },
  gameText2: {
    Text: "Choice 2",
    mustIndex: "{{gameText3.Text}}",
    Index: "{{gameText3.Index}}"
  },
  gameText3: {
    Text: "Choice 3",
    mustIndex: "{{gameText.Text}}",
    Index: "{{gameText.Index}}"
  }
}
var template = "{{gameText.Text}}";
var templateChoice = "{{gameText.mustIndex}}";
var templateIndex = "{{gameText.Index}}";
//var template2 = "{{gameText2}}";
//var template3 = "{{Choice2}}";
var option2 = Mustache.render(template, view);
var Choice1 = Mustache.render(template, choices);
var ChoiceIndex = Mustache.render(templateChoice, choices)
$("#Choice").html(Choice1);
var indexTest = "{{gameText.mustIndex}}";
var indexRender = Mustache.render(indexTest, view);
$("#mustacheid").html(indexRender);
</script>

<script id="typewriter">
var aText = [Mustache.render(template, view)]; //why does script run when text, but pause when you navigate away in a mustache
var iSpeed =25; // time delay of print out
var iIndex = 0; // start printing array at this posision
var iArrLength = aText[0].length; // the length of the text array
var iScrollAt = 20; // start scrolling up at this many lines
 
var iTextPos = 0; // initialise text position
var sContents = ''; // initialise contents variable
var iRow; // initialise current row

function typewritera()
{
 sContents =  ' ';
 iRow = Math.max(0, iIndex-iScrollAt);
 var destination = document.getElementById("typedtext");
 
 while ( iRow < iIndex ) {
  sContents += aText[iRow++] + '<br />';
 }
 destination.innerHTML = sContents + aText[iIndex].substring(0, iTextPos) + "_";
 if ( iTextPos++ == iArrLength ) {
  iTextPos = 0;
  iIndex++;
  if ( iIndex != aText.length ) {
   iArrLength = aText[iIndex].length;
   setTimeout("typewritera()", 500);
  }
 } else {
  setTimeout("typewritera()", iSpeed);
 }
}

typewritera();
 </script>

 <script>
 $(function ChangeSelection(){
  $("#Choice").click(function(){
    template = Mustache.render(templateChoice, choices); //needs to be set dynamically from user selection
    alert(template);
    Choice1 = Mustache.render(template, choices);
    $("#Choice").html(Choice1);
    aText = [Mustache.render(template, view)];
    iArrLength = aText[0].length;
    templateIndex = Mustache.render(templateIndex, choices);
    alert(templateIndex);
    templateChoice = Mustache.render(templateIndex, view);
    alert(templateChoice);
  });
});
</script>
</body> 
 </html>
